<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dunhill Miner</title>

    <!-- Google Font - Chakra Petch -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Title Screen -->
    <div class="title-screen" id="titleScreen">
        <div class="title-content">
            <img src="assets/LoadingScreen.jpg" alt="Dunhill Miner Logo" class="title-logo">
            <h1 class="title-name">Dunhill Miner</h1>
            <div class="title-buttons">
                <button class="title-btn play-btn" onclick="startGame()">
                    <span class="btn-icon">‚ñ∂</span>
                    <span>Play</span>
                </button>
                <button class="title-btn about-btn" onclick="openAboutPanel()">
                    <span class="btn-icon">üìñ</span>
                    <span>About</span>
                </button>
                <button class="title-btn credits-btn" onclick="openCreditsPanel()">
                    <span class="btn-icon">üë•</span>
                    <span>Credits</span>
                </button>
            </div>
        </div>

        <!-- About Panel -->
        <div class="title-panel about-panel-overlay" id="aboutPanelOverlay">
            <div class="title-panel-content">
                <button class="title-panel-close" onclick="closeAboutPanel()">√ó</button>
                <h2>About Dunhill Miner</h2>

                <div class="about-section">
                    <h3>‚õèÔ∏è Welcome to the Mine!</h3>
                    <p>Dunhill Miner is an idle mining game where you build and manage your own mining empire. Start from humble beginnings in Mine 22 and work your way up to becoming the most successful mining tycoon!</p>
                </div>

                <div class="about-section">
                    <h3>üèóÔ∏è Mineshafts</h3>
                    <p>Mineshafts are the heart of your mining operation. Each shaft has a miner who digs coal and deposits it into a bucket. Click on a miner to make them work faster, or hire a manager to automate the process entirely.</p>
                    <p><strong>Upgrades:</strong> Level up your shafts to increase coal production. Each upgrade increases output by 25% per level!</p>
                    <p><strong>Expansion:</strong> Purchase additional shafts to multiply your mining capacity. Each new shaft produces more base coal than the last.</p>
                </div>

                <div class="about-section">
                    <h3>üëî Managers</h3>
                    <p>Managers are the key to automation. Once hired, they automatically control their assigned worker, freeing you from constant clicking.</p>
                    <p><strong>Special Abilities:</strong> Each manager has a unique ability that can be activated for powerful bonuses:</p>
                    <ul>
                        <li><em>Discount Master</em> - Reduces upgrade costs</li>
                        <li><em>Speed Demon</em> - Temporarily boosts work speed</li>
                        <li><em>Production Boost</em> - Increases coal output</li>
                        <li><em>And more!</em></li>
                    </ul>
                    <p>Click on a manager to view their ability, activate it, or fire them if needed.</p>
                </div>

                <div class="about-section">
                    <h3>üõó Elevator</h3>
                    <p>The elevator transports coal from your mineshafts to the surface for selling. It travels between shafts, collecting coal from each bucket along the way.</p>
                    <p><strong>Capacity:</strong> Upgrade the elevator to carry more coal per trip. Each level increases capacity by 30%!</p>
                    <p><strong>Operator:</strong> The elevator operator sells the coal when it reaches the surface. Hire a manager to automate this process.</p>
                </div>

                <div class="about-section">
                    <h3>üìä Statistics</h3>
                    <p>Track your mining empire's progress! The Stats panel shows:</p>
                    <ul>
                        <li>Total coal mined throughout your career</li>
                        <li>Number of mineshafts owned</li>
                        <li>Current elevator level</li>
                        <li>Total money earned</li>
                    </ul>
                </div>

                <div class="about-section">
                    <h3>üèÜ Achievements</h3>
                    <p>Complete challenges to earn achievements! These milestones track your accomplishments as you progress through the game. From mining your first coal to becoming a mining mogul, there's always a new goal to strive for.</p>
                </div>

                <div class="about-section">
                    <h3>üó∫Ô∏è World Map</h3>
                    <p>The World Map shows your journey through different mining locations. You start at Mine 22, a coal mine, but as you progress, new locations with different minerals will become available!</p>
                    <p><strong>Coming Soon:</strong> Copper mines, gold deposits, and more exotic materials await the most dedicated miners!</p>
                </div>

                <div class="about-section">
                    <h3>üí° Tips for Success</h3>
                    <ul>
                        <li>Hire managers early to automate your operation</li>
                        <li>Balance upgrades between shafts and the elevator</li>
                        <li>Use manager abilities strategically for maximum effect</li>
                        <li>Expand to new shafts when you can afford them</li>
                        <li>Save your progress with a free account!</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Credits Panel -->
        <div class="title-panel credits-panel-overlay" id="creditsPanelOverlay">
            <div class="title-panel-content credits-content">
                <button class="title-panel-close" onclick="closeCreditsPanel()">√ó</button>
                <h2>Credits</h2>

                <div class="credits-section">
                    <div class="credit-entry lead">
                        <div class="credit-role">Lead Developer</div>
                        <div class="credit-name">Joshua G.</div>
                    </div>

                    <div class="credit-entry">
                        <div class="credit-role">Developer</div>
                        <div class="credit-name">Claude</div>
                    </div>

                    <div class="credit-entry">
                        <div class="credit-role">Developer</div>
                        <div class="credit-name">Matthew G.</div>
                    </div>
                </div>

                <div class="credits-footer">
                    <p>Thank you for playing!</p>
                    <p class="version-info">Version 1.4.0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Fade Overlay for Transitions -->
    <div class="fade-overlay" id="fadeOverlay"></div>

    <!-- Background Music -->
    <audio id="bgMusic" loop>
        <source src="assets/audio/Background1.mp3" type="audio/mpeg">
    </audio>

    <!-- Mute Button -->
    <button class="audio-btn" id="audioBtn" onclick="toggleAudio()">
        <span id="audioIcon">üîá</span>
    </button>

    <!-- Auth Button -->
    <button class="auth-btn" id="authBtn" onclick="openAuthModal()">
        Login
    </button>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <button class="auth-close" onclick="closeAuthModal()">&times;</button>
        <div class="auth-box">
            <!-- Login/Signup View -->
            <div id="authFormView">
                <h2>Account</h2>
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                    <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
                </div>

                <!-- Login Form -->
                <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                    <input type="email" class="auth-input" id="loginEmail" placeholder="Email" required>
                    <input type="password" class="auth-input" id="loginPassword" placeholder="Password" required>
                    <button type="submit" class="auth-submit">Login</button>
                    <div class="auth-error" id="loginError"></div>
                </form>

                <!-- Signup Form -->
                <form id="signupForm" class="auth-form" onsubmit="handleSignup(event)">
                    <input type="email" class="auth-input" id="signupEmail" placeholder="Email" required>
                    <input type="password" class="auth-input" id="signupPassword" placeholder="Password (min 6 chars)" required minlength="6">
                    <input type="password" class="auth-input" id="signupConfirm" placeholder="Confirm Password" required>
                    <button type="submit" class="auth-submit">Create Account</button>
                    <div class="auth-error" id="signupError"></div>
                </form>
            </div>

            <!-- Logged In View -->
            <div id="loggedInView" style="display: none;">
                <h2>Account</h2>
                <div class="user-info">
                    <div>Logged in as:</div>
                    <div class="user-email" id="userEmail"></div>
                </div>
                <button class="auth-submit" onclick="saveGameToCloud()">Save Progress</button>
                <button class="auth-submit" onclick="loadGameFromCloud()" style="background: linear-gradient(to bottom, #32CD32, #228B22); border-color: #006400;">Load Progress</button>
                <div class="save-status" id="saveStatus"></div>
                <button class="logout-btn" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </div>

    <!-- Current Mine Indicator -->
    <div class="mine-indicator" id="mineIndicator">
        <span class="mine-indicator-label">Mine</span>
        <span class="mine-indicator-name">M22</span>
    </div>

    <div class="game-header">
        <div class="stats-container">
            <div class="money-counter">
                <span class="money-icon">$</span>
                <span id="moneyCount">0</span>
            </div>
        </div>
    </div>

    <!-- Menu Buttons -->
    <div class="menu-buttons">
        <button class="menu-btn stats-btn" id="statsBtn" onclick="toggleStatsPanel()">
            <span class="menu-icon">üìä</span>
            <span class="menu-label">Stats</span>
        </button>
        <button class="menu-btn achievements-menu-btn" id="achievementsMenuBtn" onclick="toggleAchievementsPanel()">
            <span class="menu-icon">üèÜ</span>
            <span class="menu-label">Achievements</span>
            <span class="achievement-badge" id="achievementBadge" style="display: none;">0</span>
        </button>
        <button class="menu-btn map-btn" id="mapBtn" onclick="toggleMapPanel()">
            <span class="menu-icon">üó∫Ô∏è</span>
            <span class="menu-label">Map</span>
        </button>
        <button class="menu-btn updates-btn" id="updatesBtn" onclick="toggleUpdatesPanel()">
            <span class="menu-icon">üìã</span>
            <span class="menu-label">Updates</span>
        </button>
    </div>

    <div class="game-wrapper">
        <div class="game-container" id="gameContainer">
            <!-- Rock walls on sides -->
            <div class="rock-wall left-wall"></div>
            <div class="rock-wall right-wall"></div>

            <!-- Surface -->
            <div class="surface">
                <div class="sky"></div>
                <div class="clouds">
                    <div class="cloud cloud-1"></div>
                    <div class="cloud cloud-2"></div>
                    <div class="cloud cloud-3"></div>
                </div>
                <div class="sun"></div>
                <div class="grass"></div>
                <div class="surface-building">
                    <div class="building-roof"></div>
                    <div class="building-body">
                        <div class="building-window"></div>
                        <div class="building-window"></div>
                        <div class="building-door"></div>
                    </div>
                    <div class="chimney">
                        <div class="smoke"></div>
                    </div>
                </div>
                <div class="ground-rocks">
                    <div class="small-rock"></div>
                    <div class="small-rock"></div>
                    <div class="small-rock"></div>
                </div>
            </div>

            <!-- Elevator Upgrade Button -->
            <button class="elevator-upgrade-btn" id="elevatorUpgradeBtn" onclick="openElevatorUpgradeModal()"><span id="elevatorLevelDisplay">1</span></button>

            <!-- Elevator Shaft - will be extended dynamically -->
            <div class="elevator-shaft" id="elevatorShaft">
                <div class="elevator-track"></div>
                <div class="elevator" id="elevator" onclick="handleElevatorClick()">
                    <div class="elevator-capacity" id="elevatorCapacityDisplay">0/10</div>
                </div>
            </div>

            <!-- Elevator Manager Slot -->
            <div class="manager-slot" id="elevatorManagerSlot" style="left: 250px; top: 35px;">
                <span class="plus-icon">+</span>
            </div>

            <!-- Elevator Operator -->
            <div class="worker elevator-operator" id="elevatorOperator" style="left: 175px; top: 55px;">
                <div class="worker-status" id="operatorStatus">Click elevator!</div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="operatorProgressFill"></div>
                </div>
                <div class="worker-body">
                    <div class="worker-helmet">
                        <div class="worker-helmet-light"></div>
                    </div>
                    <div class="worker-head"></div>
                    <div class="worker-torso"></div>
                    <div class="worker-legs"></div>
                </div>
                <div class="carried-coal"></div>
            </div>

            <!-- Mineshafts container -->
            <div id="mineshaftsContainer"></div>

            <!-- Buy new shaft area -->
            <div class="buy-shaft-area" id="buyShaftArea">
                <button class="buy-shaft-btn" id="buyShaftBtn" onclick="buyNewShaft()">
                    Buy Shaft 2 - $500
                </button>
            </div>
        </div>
    </div>

    <!-- Hire Popup (reusable) -->
    <div class="hire-popup" id="hirePopup">
        <h4 id="hirePopupTitle">Manager</h4>
        <div class="cost" id="hirePopupCost">Cost: $50</div>
        <button class="hire-btn" id="hirePopupBtn">Hire Manager</button>
    </div>

    <!-- Manager Info Popup -->
    <div class="manager-info-popup" id="managerInfoPopup">
        <h4 id="managerInfoTitle">Manager 1</h4>
        <div class="ability-info">
            <div class="ability-name" id="managerAbilityName">30% Discount</div>
            <div class="ability-desc" id="managerAbilityDesc">30% off upgrades</div>
            <div class="ability-status" id="managerAbilityStatus">Ready to activate</div>
        </div>
        <div>
            <button class="activate-btn" id="managerActivateBtn">Activate</button>
        </div>
        <div>
            <button class="fire-btn" id="managerFireBtn">Fire Manager</button>
            <button class="close-popup-btn" id="managerCloseBtn">Close</button>
        </div>
    </div>

    <!-- Upgrade Modal -->
    <div class="modal-overlay" id="upgradeModal">
        <div class="upgrade-modal">
            <h2 id="upgradeModalTitle">Mineshaft Upgrade</h2>
            <div class="level-display">Level <span id="modalLevel">1</span></div>
            <div class="stats">
                <div class="stat-row">
                    <span class="stat-label">Coal per trip:</span>
                    <span class="stat-value" id="currentCoal">1.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Next level:</span>
                    <span class="stat-value increase" id="nextCoal">1.20</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Upgrade cost:</span>
                    <span class="stat-value" id="upgradeCost">$50</span>
                </div>
            </div>
            <div>
                <button class="upgrade-btn" id="upgradeBtn" onclick="performUpgrade()">Upgrade</button>
                <button class="close-btn" onclick="closeUpgradeModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Statistics Panel (toggleable) -->
    <div class="stats-panel" id="statsPanel">
        <div class="stats-panel-header">
            <h3>Statistics</h3>
            <button class="stats-close" onclick="toggleStatsPanel()">√ó</button>
        </div>
        <div class="stat-item">
            <span class="stat-label">Total Coal Mined</span>
            <span class="stat-value" id="statTotalCoal">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Mineshafts Owned</span>
            <span class="stat-value" id="statMineshafts">1</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Elevator Level</span>
            <span class="stat-value" id="statElevatorLevel">1</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Total Money Earned</span>
            <span class="stat-value" id="statTotalMoney">$0</span>
        </div>
    </div>

    <!-- Achievements Panel (side panel) -->
    <div class="side-panel achievements-panel" id="achievementsPanel">
        <div class="side-panel-header">
            <h3>Achievements</h3>
            <button class="panel-close" onclick="toggleAchievementsPanel()">√ó</button>
        </div>
        <div class="side-panel-content" id="achievementsList"></div>
    </div>

    <!-- Updates Panel (side panel) -->
    <div class="side-panel updates-panel" id="updatesPanel">
        <div class="side-panel-header updates-header">
            <h3>Update Log</h3>
            <button class="panel-close" onclick="toggleUpdatesPanel()">√ó</button>
        </div>
        <div class="side-panel-content" id="updatesList"></div>
    </div>

    <!-- Map Panel (side panel) -->
    <div class="side-panel map-panel" id="mapPanel">
        <div class="side-panel-header map-header">
            <h3>World Map</h3>
            <button class="panel-close" onclick="toggleMapPanel()">√ó</button>
        </div>
        <div class="side-panel-content map-content">
            <div class="map-journey">
                <div class="map-location current" id="mapLocation-m22">
                    <div class="map-location-icon">‚õèÔ∏è</div>
                    <div class="map-location-name">Mine 22</div>
                    <div class="map-location-status">Current</div>
                </div>
                <div class="map-path">
                    <span class="path-dot"></span>
                    <span class="path-dot"></span>
                    <span class="path-dot"></span>
                    <span class="path-dot"></span>
                    <span class="path-dot"></span>
                </div>
                <div class="map-location locked" id="mapLocation-copper">
                    <div class="map-location-icon">?</div>
                    <div class="map-location-name">TBD Copper</div>
                    <div class="map-location-status">Locked</div>
                </div>
                <div class="map-path">
                    <span class="path-dot"></span>
                    <span class="path-dot"></span>
                    <span class="path-dot"></span>
                    <span class="path-dot"></span>
                    <span class="path-dot"></span>
                </div>
                <div class="map-location locked">
                    <div class="map-location-icon">?</div>
                    <div class="map-location-name">???</div>
                    <div class="map-location-status">Locked</div>
                </div>
            </div>
            <div class="map-legend">
                <div class="map-legend-item">
                    <span class="legend-icon current">‚óè</span>
                    <span>Current Mine</span>
                </div>
                <div class="map-legend-item">
                    <span class="legend-icon locked">‚óè</span>
                    <span>Locked</span>
                </div>
            </div>
        </div>
    </div>

    <script src="updates.js"></script>
    <script src="game.js"></script>
</body>
</html>
