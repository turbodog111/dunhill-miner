<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idle Miner</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Background Music -->
    <audio id="bgMusic" loop>
        <source src="Background1.mp3" type="audio/mpeg">
    </audio>

    <!-- Mute Button -->
    <button class="audio-btn" id="audioBtn" onclick="toggleAudio()">
        <span id="audioIcon">ðŸ”‡</span>
    </button>

    <!-- Auth Button -->
    <button class="auth-btn" id="authBtn" onclick="openAuthModal()">
        Login
    </button>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <button class="auth-close" onclick="closeAuthModal()">&times;</button>
        <div class="auth-box">
            <!-- Login/Signup View -->
            <div id="authFormView">
                <h2>Account</h2>
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                    <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
                </div>

                <!-- Login Form -->
                <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                    <input type="email" class="auth-input" id="loginEmail" placeholder="Email" required>
                    <input type="password" class="auth-input" id="loginPassword" placeholder="Password" required>
                    <button type="submit" class="auth-submit">Login</button>
                    <div class="auth-error" id="loginError"></div>
                </form>

                <!-- Signup Form -->
                <form id="signupForm" class="auth-form" onsubmit="handleSignup(event)">
                    <input type="email" class="auth-input" id="signupEmail" placeholder="Email" required>
                    <input type="password" class="auth-input" id="signupPassword" placeholder="Password (min 6 chars)" required minlength="6">
                    <input type="password" class="auth-input" id="signupConfirm" placeholder="Confirm Password" required>
                    <button type="submit" class="auth-submit">Create Account</button>
                    <div class="auth-error" id="signupError"></div>
                </form>
            </div>

            <!-- Logged In View -->
            <div id="loggedInView" style="display: none;">
                <h2>Account</h2>
                <div class="user-info">
                    <div>Logged in as:</div>
                    <div class="user-email" id="userEmail"></div>
                </div>
                <button class="auth-submit" onclick="saveGameToCloud()">Save Progress</button>
                <button class="auth-submit" onclick="loadGameFromCloud()" style="background: linear-gradient(to bottom, #32CD32, #228B22); border-color: #006400;">Load Progress</button>
                <div class="save-status" id="saveStatus"></div>
                <button class="logout-btn" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </div>

    <div class="game-header">
        <div class="stats-container">
            <div class="coal-counter">
                <span class="coal-icon"></span>
                <span id="coalCount">0</span> Coal Sold
            </div>
            <div class="money-counter">
                <span class="money-icon">$</span>
                <span id="moneyCount">0</span>
            </div>
        </div>
    </div>

    <div class="game-wrapper">
        <div class="game-container" id="gameContainer">
            <!-- Surface -->
            <div class="surface">
                <div class="surface-building"></div>
            </div>

            <!-- Elevator Upgrade Button -->
            <button class="elevator-upgrade-btn" id="elevatorUpgradeBtn" onclick="openElevatorUpgradeModal()"><span id="elevatorLevelDisplay">1</span></button>

            <!-- Elevator Shaft - will be extended dynamically -->
            <div class="elevator-shaft" id="elevatorShaft">
                <div class="elevator-track"></div>
                <div class="elevator" id="elevator" onclick="handleElevatorClick()">
                    <div class="elevator-capacity" id="elevatorCapacityDisplay">0/10</div>
                </div>
            </div>

            <!-- Elevator Manager Slot -->
            <div class="manager-slot" id="elevatorManagerSlot" style="left: 250px; top: 35px;">
                <span class="plus-icon">+</span>
            </div>

            <!-- Elevator Operator -->
            <div class="worker elevator-operator" id="elevatorOperator" style="left: 175px; top: 55px;">
                <div class="worker-status" id="operatorStatus">Click elevator!</div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="operatorProgressFill"></div>
                </div>
                <div class="worker-body">
                    <div class="worker-helmet">
                        <div class="worker-helmet-light"></div>
                    </div>
                    <div class="worker-head"></div>
                    <div class="worker-torso"></div>
                    <div class="worker-legs"></div>
                </div>
                <div class="carried-coal"></div>
            </div>

            <!-- Mineshafts container -->
            <div id="mineshaftsContainer"></div>

            <!-- Buy new shaft area -->
            <div class="buy-shaft-area" id="buyShaftArea">
                <button class="buy-shaft-btn" id="buyShaftBtn" onclick="buyNewShaft()">
                    Buy Shaft 2 - $500
                </button>
            </div>
        </div>
    </div>

    <!-- Hire Popup (reusable) -->
    <div class="hire-popup" id="hirePopup">
        <h4 id="hirePopupTitle">Manager</h4>
        <div class="cost" id="hirePopupCost">Cost: $50</div>
        <button class="hire-btn" id="hirePopupBtn">Hire Manager</button>
    </div>

    <!-- Manager Info Popup -->
    <div class="manager-info-popup" id="managerInfoPopup">
        <h4 id="managerInfoTitle">Manager 1</h4>
        <div class="ability-info">
            <div class="ability-name" id="managerAbilityName">30% Discount</div>
            <div class="ability-desc" id="managerAbilityDesc">30% off upgrades</div>
            <div class="ability-status" id="managerAbilityStatus">Ready to activate</div>
        </div>
        <div>
            <button class="activate-btn" id="managerActivateBtn">Activate</button>
        </div>
        <div>
            <button class="fire-btn" id="managerFireBtn">Fire Manager</button>
            <button class="close-popup-btn" id="managerCloseBtn">Close</button>
        </div>
    </div>

    <!-- Upgrade Modal -->
    <div class="modal-overlay" id="upgradeModal">
        <div class="upgrade-modal">
            <h2 id="upgradeModalTitle">Mineshaft Upgrade</h2>
            <div class="level-display">Level <span id="modalLevel">1</span></div>
            <div class="stats">
                <div class="stat-row">
                    <span class="stat-label">Coal per trip:</span>
                    <span class="stat-value" id="currentCoal">1.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Next level:</span>
                    <span class="stat-value increase" id="nextCoal">1.20</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Upgrade cost:</span>
                    <span class="stat-value" id="upgradeCost">$50</span>
                </div>
            </div>
            <div>
                <button class="upgrade-btn" id="upgradeBtn" onclick="performUpgrade()">Upgrade</button>
                <button class="close-btn" onclick="closeUpgradeModal()">Close</button>
            </div>
        </div>
    </div>

    <div class="instructions">
        <h3>Idle Miner</h3>
        <p>Click workers to mine | Hire managers ($50)</p>
        <p>Buy new shafts ($500) | Upgrade elevator capacity!</p>
    </div>

    <!-- Player Stats Panel -->
    <div class="player-stats-panel" id="playerStatsPanel">
        <h3>Player Stats</h3>
        <div class="stat-item">
            <span class="stat-label">Total Coal Mined:</span>
            <span class="stat-value" id="statTotalCoal">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Mineshafts:</span>
            <span class="stat-value" id="statMineshafts">1</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Managers:</span>
            <span class="stat-value" id="statManagers">0</span>
        </div>
        <button class="achievements-btn" id="achievementsBtn" onclick="openAchievementsModal()">
            Achievements
            <span class="achievement-badge" id="achievementBadge" style="display: none;">0</span>
        </button>
    </div>

    <!-- Achievements Modal -->
    <div class="achievements-modal" id="achievementsModal">
        <div class="achievements-content">
            <div class="achievements-header">
                <h2>Achievements</h2>
                <button class="achievements-close" onclick="closeAchievementsModal()">X</button>
            </div>
            <div id="achievementsList"></div>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>
